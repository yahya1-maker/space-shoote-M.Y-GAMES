<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Space Shooter - FATEH GAMES</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            user-select: none;
        }
        
        body {
            font-family: 'Arial', sans-serif;
            background: #000;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            min-height: 100vh;
            overflow: hidden;
        }
        
        .game-container {
            position: relative;
            width: 800px;
            max-width: 95%;
            text-align: center;
        }
        
        /* Screens */
        .screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 50, 0.9);
            padding: 30px;
            border-radius: 15px;
            border: 3px solid #00a8ff;
            text-align: center;
            box-shadow: 0 0 30px rgba(0, 168, 255, 0.7);
            z-index: 10;
            width: 90%;
            max-width: 500px;
        }
        
        /* Popup Screens */
        .popup-screen {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: rgba(0, 0, 50, 0.95);
            padding: 25px;
            border-radius: 15px;
            border: 3px solid #00a8ff;
            text-align: center;
            box-shadow: 0 0 40px rgba(0, 168, 255, 0.8);
            z-index: 20;
            width: 400px;
            max-width: 90%;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .popup-title {
            font-size: 1.8rem;
            color: #00a8ff;
            text-shadow: 0 0 10px #00a8ff;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid #00a8ff;
        }
        
        .popup-content {
            text-align: left;
            line-height: 1.6;
            margin-bottom: 20px;
        }
        
        .popup-section {
            margin-bottom: 15px;
        }
        
        .popup-section h3 {
            color: #ffcc00;
            margin-bottom: 8px;
            font-size: 1.2rem;
        }
        
        .popup-section p {
            margin-bottom: 5px;
            color: #a0a0ff;
        }
        
        .popup-list {
            list-style-type: none;
            padding-left: 15px;
        }
        
        .popup-list li {
            margin-bottom: 8px;
            color: #a0a0ff;
            position: relative;
        }
        
        .popup-list li:before {
            content: "‚Ä¢";
            color: #00ffea;
            font-weight: bold;
            position: absolute;
            left: -15px;
        }
        
        .close-btn {
            background: linear-gradient(to bottom, #ff4d4d, #cc0000);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1rem;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .close-btn:hover {
            background: linear-gradient(to bottom, #ff5d5d, #dd0000);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        
        /* Splash Screen */
        #splashScreen {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }
        
        .splash-logo {
            font-size: 4rem;
            color: #00a8ff;
            text-shadow: 0 0 20px #00a8ff, 0 0 40px #0088cc;
            margin-bottom: 30px;
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.05); }
        }
        
        .loading-bar-container {
            width: 100%;
            height: 20px;
            background: rgba(0, 50, 100, 0.5);
            border-radius: 10px;
            border: 2px solid #00a8ff;
            margin: 20px 0;
            overflow: hidden;
        }
        
        .loading-bar {
            height: 100%;
            background: linear-gradient(90deg, #00a8ff, #00ffea);
            border-radius: 8px;
            width: 0%;
            transition: width 0.3s;
        }
        
        .loading-text {
            font-size: 1.2rem;
            color: #a0a0ff;
            margin-top: 10px;
        }
        
        /* Main Menu */
        #mainMenu {
            display: none;
        }
        
        .menu-title {
            font-size: 3rem;
            color: #00a8ff;
            text-shadow: 0 0 15px #00a8ff;
            margin-bottom: 10px;
        }
        
        .menu-subtitle {
            font-size: 1.2rem;
            color: #a0a0ff;
            margin-bottom: 30px;
        }
        
        .menu-buttons {
            display: flex;
            flex-direction: column;
            gap: 15px;
            width: 100%;
        }
        
        .menu-btn {
            background: linear-gradient(to bottom, #00a8ff, #0077cc);
            color: white;
            border: none;
            padding: 15px 20px;
            font-size: 1.3rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .menu-btn:hover {
            background: linear-gradient(to bottom, #00b8ff, #0088dd);
            transform: translateY(-3px);
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.4);
        }
        
        .menu-btn.secondary {
            background: linear-gradient(to bottom, #ff4d4d, #cc0000);
        }
        
        .menu-btn.secondary:hover {
            background: linear-gradient(to bottom, #ff5d5d, #dd0000);
        }
        
        /* Level Menu */
        #levelMenu {
            display: none;
        }
        
        .level-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 15px;
            margin: 20px 0;
        }
        
        .level-btn {
            background: linear-gradient(to bottom, #4d4dff, #0000cc);
            color: white;
            border: none;
            padding: 15px 10px;
            font-size: 1.2rem;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3);
        }
        
        .level-btn:hover {
            background: linear-gradient(to bottom, #5d5dff, #0000dd);
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(0, 0, 0, 0.4);
        }
        
        .level-btn.completed {
            background: linear-gradient(to bottom, #4dff4d, #00cc00);
        }
        
        .level-btn.locked {
            background: linear-gradient(to bottom, #666, #333);
            cursor: not-allowed;
            opacity: 0.6;
        }
        
        .menu-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        /* Game UI */
        .game-ui {
            display: none;
        }
        
        .game-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        
        h1 {
            font-size: 2.2rem;
            text-shadow: 0 0 10px #00a8ff;
            letter-spacing: 2px;
        }
        
        .brand {
            font-size: 1.5rem;
            color: #ffcc00;
            font-weight: bold;
            text-shadow: 0 0 10px #ff6600;
            font-style: italic;
        }
        
        .game-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            background: rgba(0, 0, 50, 0.5);
            padding: 8px 15px;
            border-radius: 10px;
            border: 1px solid #00a8ff;
        }
        
        .info-item {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .info-label {
            font-size: 0.8rem;
            color: #a0a0ff;
        }
        
        .info-value {
            font-size: 1.3rem;
            font-weight: bold;
            color: #00ffea;
        }
        
        #gameCanvas {
            background: #000;
            border: 3px solid #00a8ff;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0, 168, 255, 0.5);
            display: block;
            margin: 0 auto;
            width: 100%;
            max-width: 800px;
            height: auto;
            aspect-ratio: 8/5;
        }
        
        .on-screen-controls {
            display: flex;
            justify-content: space-between;
            width: 100%;
            max-width: 800px;
            margin: 8px auto 5px;
            padding: 0 10px;
        }
        
        .d-pad {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            grid-template-rows: repeat(3, 1fr);
            gap: 6px;
            width: 150px;
            height: 150px;
        }
        
        .d-pad-btn {
            background: rgba(0, 50, 100, 0.7);
            border: 2px solid #00a8ff;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 22px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .d-pad-btn:active {
            background: rgba(0, 100, 200, 0.9);
            transform: scale(0.95);
        }
        
        .d-pad-up {
            grid-column: 2;
            grid-row: 1;
        }
        
        .d-pad-left {
            grid-column: 1;
            grid-row: 2;
        }
        
        .d-pad-center {
            grid-column: 2;
            grid-row: 2;
            background: rgba(0, 50, 100, 0.3);
            border: none;
        }
        
        .d-pad-right {
            grid-column: 3;
            grid-row: 2;
        }
        
        .d-pad-down {
            grid-column: 2;
            grid-row: 3;
        }
        
        .action-buttons {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        
        .action-btn {
            background: rgba(200, 50, 50, 0.7);
            border: 2px solid #ff4d4d;
            border-radius: 50%;
            width: 75px;
            height: 75px;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 13px;
            font-weight: bold;
            cursor: pointer;
            transition: all 0.2s;
            text-align: center;
            padding: 8px;
        }
        
        .action-btn:active {
            background: rgba(220, 70, 70, 0.9);
            transform: scale(0.95);
        }
        
        .action-btn.missile {
            background: rgba(200, 150, 50, 0.7);
            border: 2px solid #ffcc00;
        }
        
        .action-btn.missile:active {
            background: rgba(220, 170, 70, 0.9);
        }
        
        .level-indicator {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 50, 0.7);
            padding: 5px 15px;
            border-radius: 20px;
            border: 2px solid #00a8ff;
            font-size: 1.2rem;
            color: #00ffea;
            z-index: 5;
        }
        
        /* Game Over Screens */
        .game-over, .level-complete, .game-complete {
            display: none;
        }
        
        .game-over h2, .level-complete h2, .game-complete h2 {
            font-size: 2.2rem;
            margin-bottom: 15px;
            color: #ff4d4d;
        }
        
        .level-complete h2 {
            color: #4dff4d;
        }
        
        .game-complete h2 {
            color: #ffcc00;
            text-shadow: 0 0 10px #ff9900;
        }
        
        .restart-btn, .next-level-btn {
            background: linear-gradient(to bottom, #00a8ff, #0077cc);
            color: white;
            border: none;
            padding: 10px 20px;
            font-size: 1.1rem;
            border-radius: 8px;
            cursor: pointer;
            margin-top: 15px;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
        }
        
        .restart-btn:hover, .next-level-btn:hover {
            background: linear-gradient(to bottom, #00b8ff, #0088dd);
            transform: translateY(-2px);
            box-shadow: 0 7px 20px rgba(0, 0, 0, 0.4);
        }
        
        .space-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: -1;
            overflow: hidden;
        }
        
        .star {
            position: absolute;
            background: white;
            border-radius: 50%;
            animation: twinkle 5s infinite;
        }
        
        .nebula {
            position: absolute;
            border-radius: 50%;
            filter: blur(50px);
            opacity: 0.3;
        }
        
        .distant-planet {
            position: absolute;
            border-radius: 50%;
            filter: blur(2px);
        }
        
        @keyframes twinkle {
            0%, 100% { opacity: 0.2; }
            50% { opacity: 1; }
        }

        @keyframes float {
            0%, 100% { transform: translateY(0px) rotate(0deg); }
            50% { transform: translateY(-20px) rotate(180deg); }
        }

        @media (max-width: 600px) {
            .menu-title {
                font-size: 2.5rem;
            }
            
            .level-grid {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .splash-logo {
                font-size: 3rem;
            }
            
            h1 {
                font-size: 1.8rem;
            }
            
            .brand {
                font-size: 1.2rem;
            }
            
            .game-info {
                padding: 6px 12px;
                margin-bottom: 6px;
            }
            
            .info-value {
                font-size: 1.1rem;
            }
            
            .d-pad {
                width: 130px;
                height: 130px;
            }
            
            .action-btn {
                width: 65px;
                height: 65px;
                font-size: 11px;
            }
            
            .on-screen-controls {
                margin: 6px auto 3px;
            }
            
            .level-indicator {
                font-size: 1rem;
                padding: 4px 12px;
            }
            
            .popup-screen {
                width: 350px;
                padding: 20px;
            }
            
            .popup-title {
                font-size: 1.6rem;
            }
        }
    </style>
</head>
<body>
    <div class="space-background" id="spaceBackground"></div>
    
    <div class="game-container">
        <!-- Splash Screen -->
        <div class="screen" id="splashScreen">
            <div class="splash-logo">üöÄ</div>
            <h2>SPACE SHOOTER</h2>
            <p>FATEH GAMES PRESENTS</p>
            <div class="loading-bar-container">
                <div class="loading-bar" id="loadingBar"></div>
            </div>
            <div class="loading-text" id="loadingText">Loading game assets...</div>
        </div>
        
        <!-- Main Menu -->
        <div class="screen" id="mainMenu">
            <div class="menu-title">SPACE SHOOTER</div>
            <div class="menu-subtitle">Defend the galaxy from alien invasion!</div>
            <div class="menu-buttons">
                <button class="menu-btn" onclick="showLevelMenu()">START MISSION</button>
                <button class="menu-btn" onclick="showLevelMenu()">LEVEL SELECT</button>
                <button class="menu-btn" onclick="showInstructions()">INSTRUCTIONS</button>
                <button class="menu-btn secondary" onclick="showCredits()">CREDITS</button>
            </div>
        </div>
        
        <!-- Level Menu -->
        <div class="screen" id="levelMenu">
            <div class="menu-title">SELECT LEVEL</div>
            <div class="level-grid" id="levelGrid">
                <!-- Level buttons will be generated here -->
            </div>
            <div class="menu-nav">
                <button class="menu-btn secondary" onclick="showMainMenu()">BACK</button>
                <button class="menu-btn" onclick="startRandomLevel()">RANDOM LEVEL</button>
            </div>
        </div>
        
        <!-- Game UI (hidden by default) -->
        <div class="game-ui" id="gameUI">
            <div class="game-header">
                <h1>SPACE SHOOTER</h1>
                <div class="brand">FATEH GAMES</div>
            </div>
            
            <div class="game-info">
                <div class="info-item">
                    <span class="info-label">SCORE</span>
                    <span class="info-value" id="score">0</span>
                </div>
                <div class="info-item">
                    <span class="info-label">LIVES</span>
                    <span class="info-value" id="lives">3</span>
                </div>
                <div class="info-item">
                    <span class="info-label">ENEMIES</span>
                    <span class="info-value" id="enemies">10</span>
                </div>
                <div class="info-item">
                    <span class="info-label">MISSILES</span>
                    <span class="info-value" id="missiles">3</span>
                </div>
            </div>
            
            <canvas id="gameCanvas" width="800" height="500"></canvas>
            <div class="level-indicator" id="levelIndicator">LEVEL 1</div>
            
            <div class="on-screen-controls">
                <div class="d-pad">
                    <div class="d-pad-btn d-pad-up">‚Üë</div>
                    <div class="d-pad-btn d-pad-left">‚Üê</div>
                    <div class="d-pad-btn d-pad-center"></div>
                    <div class="d-pad-btn d-pad-right">‚Üí</div>
                    <div class="d-pad-btn d-pad-down">‚Üì</div>
                </div>
                
                <div class="action-buttons">
                    <div class="action-btn shoot">FIRE<br>BULLET</div>
                    <div class="action-btn missile">LAUNCH<br>MISSILE</div>
                </div>
            </div>
        </div>
        
        <!-- Instructions Popup -->
        <div class="popup-screen" id="instructionsPopup" style="display: none;">
            <div class="popup-title">GAME INSTRUCTIONS</div>
            <div class="popup-content">
                <div class="popup-section">
                    <h3>üéØ OBJECTIVE</h3>
                    <p>Destroy all enemy ships to complete each level. Avoid enemy bullets and collisions!</p>
                </div>
                
                <div class="popup-section">
                    <h3>üéÆ CONTROLS</h3>
                    <ul class="popup-list">
                        <li><strong>Arrow Keys</strong> - Move your spaceship</li>
                        <li><strong>Spacebar</strong> - Shoot bullets</li>
                        <li><strong>M Key</strong> - Launch homing missiles</li>
                        <li><strong>Touch Controls</strong> - Available on mobile devices</li>
                        <li><strong>Escape Key</strong> - Return to main menu</li>
                    </ul>
                </div>
                
                <div class="popup-section">
                    <h3>‚≠ê GAMEPLAY</h3>
                    <ul class="popup-list">
                        <li>Destroy enemies to earn points</li>
                        <li>Higher levels give more points</li>
                        <li>Missiles deal more damage but are limited</li>
                        <li>Enemies get tougher each level</li>
                        <li>Complete all 12 levels to win!</li>
                    </ul>
                </div>
                
                <div class="popup-section">
                    <h3>üí° TIPS</h3>
                    <ul class="popup-list">
                        <li>Save missiles for tougher enemies</li>
                        <li>Keep moving to avoid enemy fire</li>
                        <li>Watch enemy health bars</li>
                        <li>Use the entire screen for maneuvering</li>
                    </ul>
                </div>
            </div>
            <button class="close-btn" onclick="hidePopup('instructionsPopup')">CLOSE</button>
        </div>
        
        <!-- Credits Popup -->
        <div class="popup-screen" id="creditsPopup" style="display: none;">
            <div class="popup-title">CREDITS</div>
            <div class="popup-content">
                <div class="popup-section">
                    <h3>üöÄ SPACE SHOOTER</h3>
                    <p>A classic arcade-style space shooter game with modern features and 12 challenging levels.</p>
                </div>
                
                <div class="popup-section">
                    <h3>üë®‚Äçüíª DEVELOPED BY</h3>
                    <ul class="popup-list">
                        <li><strong>FATEH GAMES</strong></li>
                        <li>Game Design & Development</li>
                        <li>Graphics & Visual Effects</li>
                        <li>Sound Design & Music</li>
                    </ul>
                </div>
                
                <div class="popup-section">
                    <h3>üé® SPECIAL THANKS</h3>
                    <ul class="popup-list">
                        <li>All the brave space defenders</li>
                        <li>Beta testers & feedback providers</li>
                        <li>The gaming community</li>
                        <li>Classic arcade game inspiration</li>
                    </ul>
                </div>
                
                <div class="popup-section">
                    <h3>üì± FEATURES</h3>
                    <ul class="popup-list">
                        <li>12 Progressive Levels</li>
                        <li>Touch & Keyboard Controls</li>
                        <li>Enemy AI with Shooting</li>
                        <li>Homing Missiles</li>
                        <li>Particle Effects</li>
                        <li>Responsive Design</li>
                    </ul>
                </div>
                
                <div class="popup-section">
                    <h3>üåü DEDICATION</h3>
                    <p>This game is dedicated to all fans of classic space shooters and everyone who dreams of exploring the cosmos!</p>
                </div>
            </div>
            <button class="close-btn" onclick="hidePopup('creditsPopup')">CLOSE</button>
        </div>
        
        <!-- Game Over Screens -->
        <div class="screen game-over" id="gameOver">
            <h2>GAME OVER</h2>
            <p>Your final score: <span id="finalScore">0</span></p>
            <p>Level reached: <span id="finalLevel">1</span></p>
            <button class="restart-btn" onclick="restartGame()">PLAY AGAIN</button>
            <button class="menu-btn secondary" onclick="showMainMenu()">MAIN MENU</button>
        </div>
        
        <div class="screen level-complete" id="levelComplete">
            <h2>LEVEL COMPLETE!</h2>
            <p>Your score: <span id="completeScore">0</span></p>
            <p>Next Level: <span id="nextLevelNumber">2</span></p>
            <button class="next-level-btn" onclick="nextLevel()">NEXT LEVEL</button>
            <button class="menu-btn secondary" onclick="showMainMenu()">MAIN MENU</button>
        </div>
        
        <div class="screen game-complete" id="gameComplete">
            <h2>CONGRATULATIONS!</h2>
            <p>You've completed all 12 levels!</p>
            <p>Final Score: <span id="totalScore">0</span></p>
            <button class="restart-btn" onclick="restartGame()">PLAY AGAIN</button>
            <button class="menu-btn secondary" onclick="showMainMenu()">MAIN MENU</button>
        </div>
    </div>

    <script>
        // Game variables
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreElement = document.getElementById('score');
        const livesElement = document.getElementById('lives');
        const enemiesElement = document.getElementById('enemies');
        const missilesElement = document.getElementById('missiles');
        
        // Screen elements
        const splashScreen = document.getElementById('splashScreen');
        const mainMenu = document.getElementById('mainMenu');
        const levelMenu = document.getElementById('levelMenu');
        const gameUI = document.getElementById('gameUI');
        const gameOverScreen = document.getElementById('gameOver');
        const levelCompleteScreen = document.getElementById('levelComplete');
        const gameCompleteScreen = document.getElementById('gameComplete');
        const finalScoreElement = document.getElementById('finalScore');
        const finalLevelElement = document.getElementById('finalLevel');
        const completeScoreElement = document.getElementById('completeScore');
        const nextLevelNumberElement = document.getElementById('nextLevelNumber');
        const totalScoreElement = document.getElementById('totalScore');
        const levelIndicator = document.getElementById('levelIndicator');
        const loadingBar = document.getElementById('loadingBar');
        const loadingText = document.getElementById('loadingText');
        const levelGrid = document.getElementById('levelGrid');
        
        // Popup elements
        const instructionsPopup = document.getElementById('instructionsPopup');
        const creditsPopup = document.getElementById('creditsPopup');
        
        // On-screen control elements
        const dPadUp = document.querySelector('.d-pad-up');
        const dPadDown = document.querySelector('.d-pad-down');
        const dPadLeft = document.querySelector('.d-pad-left');
        const dPadRight = document.querySelector('.d-pad-right');
        const shootBtn = document.querySelector('.action-btn.shoot');
        const missileBtn = document.querySelector('.action-btn.missile');
        
        // Level configuration
        const LEVELS = [
            // Level 1: Basic enemies, slow speed
            {
                enemyCount: 10,
                enemySpeed: 1.0,
                enemyShootFrequency: 0.01,
                enemyHealth: 1,
                enemyBulletSpeed: 5,
                playerSpeed: 5,
                missileCount: 3,
                name: "Training Grounds"
            },
            // Level 2: Slightly faster enemies
            {
                enemyCount: 12,
                enemySpeed: 1.2,
                enemyShootFrequency: 0.012,
                enemyHealth: 1,
                enemyBulletSpeed: 5.5,
                playerSpeed: 5,
                missileCount: 3,
                name: "Asteroid Belt"
            },
            // Level 3: More enemies, faster shooting
            {
                enemyCount: 14,
                enemySpeed: 1.4,
                enemyShootFrequency: 0.015,
                enemyHealth: 1,
                enemyBulletSpeed: 6,
                playerSpeed: 5,
                missileCount: 3,
                name: "Cosmic Outpost"
            },
            // Level 4: Enemies with more health
            {
                enemyCount: 12,
                enemySpeed: 1.5,
                enemyShootFrequency: 0.018,
                enemyHealth: 2,
                enemyBulletSpeed: 6.5,
                playerSpeed: 5.5,
                missileCount: 4,
                name: "Nebula Zone"
            },
            // Level 5: Faster enemies, more bullets
            {
                enemyCount: 15,
                enemySpeed: 1.7,
                enemyShootFrequency: 0.02,
                enemyHealth: 2,
                enemyBulletSpeed: 7,
                playerSpeed: 5.5,
                missileCount: 4,
                name: "Void Frontier"
            },
            // Level 6: Even more enemies
            {
                enemyCount: 18,
                enemySpeed: 1.8,
                enemyShootFrequency: 0.022,
                enemyHealth: 2,
                enemyBulletSpeed: 7.5,
                playerSpeed: 6,
                missileCount: 4,
                name: "Alien Stronghold"
            },
            // Level 7: Tough enemies with more health
            {
                enemyCount: 15,
                enemySpeed: 2.0,
                enemyShootFrequency: 0.025,
                enemyHealth: 3,
                enemyBulletSpeed: 8,
                playerSpeed: 6,
                missileCount: 5,
                name: "Dark Matter Field"
            },
            // Level 8: Fast and numerous enemies
            {
                enemyCount: 20,
                enemySpeed: 2.2,
                enemyShootFrequency: 0.028,
                enemyHealth: 3,
                enemyBulletSpeed: 8.5,
                playerSpeed: 6.5,
                missileCount: 5,
                name: "Quantum Realm"
            },
            // Level 9: Very challenging
            {
                enemyCount: 18,
                enemySpeed: 2.4,
                enemyShootFrequency: 0.03,
                enemyHealth: 4,
                enemyBulletSpeed: 9,
                playerSpeed: 6.5,
                missileCount: 5,
                name: "Singularity Approach"
            },
            // Level 10: Extreme challenge
            {
                enemyCount: 22,
                enemySpeed: 2.6,
                enemyShootFrequency: 0.032,
                enemyHealth: 4,
                enemyBulletSpeed: 9.5,
                playerSpeed: 7,
                missileCount: 6,
                name: "Final Stand"
            },
            // Level 11: Nearly impossible
            {
                enemyCount: 20,
                enemySpeed: 2.8,
                enemyShootFrequency: 0.035,
                enemyHealth: 5,
                enemyBulletSpeed: 10,
                playerSpeed: 7,
                missileCount: 6,
                name: "Cosmic Annihilation"
            },
            // Level 12: Final boss level
            {
                enemyCount: 25,
                enemySpeed: 3.0,
                enemyShootFrequency: 0.04,
                enemyHealth: 5,
                enemyBulletSpeed: 10.5,
                playerSpeed: 7.5,
                missileCount: 7,
                name: "Galactic Showdown"
            }
        ];
        
        let currentLevel = 0;
        let player = null;
        let enemies = [];
        let explosions = [];
        let gameOver = false;
        let levelComplete = false;
        let keys = {};
        let completedLevels = new Array(LEVELS.length).fill(false);
        let gameRunning = false;
        
        // Create space background with stars, nebulae, and planets
        function createSpaceBackground() {
            const spaceContainer = document.getElementById('spaceBackground');
            
            // Create stars
            for (let i = 0; i < 200; i++) {
                const star = document.createElement('div');
                star.className = 'star';
                star.style.width = Math.random() * 3 + 'px';
                star.style.height = star.style.width;
                star.style.left = Math.random() * 100 + '%';
                star.style.top = Math.random() * 100 + '%';
                star.style.animationDelay = Math.random() * 5 + 's';
                star.style.opacity = Math.random() * 0.8 + 0.2;
                spaceContainer.appendChild(star);
            }
            
            // Create nebulae
            for (let i = 0; i < 4; i++) {
                const nebula = document.createElement('div');
                nebula.className = 'nebula';
                nebula.style.width = Math.random() * 300 + 200 + 'px';
                nebula.style.height = nebula.style.width;
                nebula.style.left = Math.random() * 100 + '%';
                nebula.style.top = Math.random() * 100 + '%';
                
                // Random nebula colors
                const colors = [
                    'rgba(100, 50, 200, 0.3)',  // Purple
                    'rgba(200, 50, 100, 0.3)',  // Pink
                    'rgba(50, 100, 200, 0.3)',  // Blue
                    'rgba(200, 150, 50, 0.3)'   // Orange
                ];
                nebula.style.background = colors[Math.floor(Math.random() * colors.length)];
                nebula.style.animation = `float ${Math.random() * 30 + 30}s infinite ease-in-out`;
                spaceContainer.appendChild(nebula);
            }
            
            // Create distant planets
            for (let i = 0; i < 3; i++) {
                const planet = document.createElement('div');
                planet.className = 'distant-planet';
                const size = Math.random() * 100 + 50;
                planet.style.width = size + 'px';
                planet.style.height = size + 'px';
                planet.style.left = Math.random() * 100 + '%';
                planet.style.top = Math.random() * 100 + '%';
                
                // Random planet colors and features
                const planetColors = [
                    'radial-gradient(circle at 30% 30%, #ff6b6b, #c44569)',
                    'radial-gradient(circle at 30% 30%, #74b9ff, #0984e3)',
                    'radial-gradient(circle at 30% 30%, #55efc4, #00b894)',
                    'radial-gradient(circle at 30% 30%, #fdcb6e, #e17055)'
                ];
                planet.style.background = planetColors[Math.floor(Math.random() * planetColors.length)];
                planet.style.animation = `float ${Math.random() * 40 + 40}s infinite ease-in-out`;
                spaceContainer.appendChild(planet);
            }
        }
        
        // Simulate loading process
        function simulateLoading() {
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 10;
                if (progress >= 100) {
                    progress = 100;
                    clearInterval(interval);
                    loadingText.textContent = "Ready!";
                    setTimeout(showMainMenu, 800);
                } else {
                    loadingBar.style.width = `${progress}%`;
                    
                    // Update loading text based on progress
                    if (progress < 30) {
                        loadingText.textContent = "Loading game assets...";
                    } else if (progress < 60) {
                        loadingText.textContent = "Initializing space environment...";
                    } else if (progress < 90) {
                        loadingText.textContent = "Preparing enemy forces...";
                    } else {
                        loadingText.textContent = "Finalizing mission parameters...";
                    }
                }
            }, 200);
        }
        
        // Show main menu
        function showMainMenu() {
            splashScreen.style.display = 'none';
            mainMenu.style.display = 'block';
            levelMenu.style.display = 'none';
            gameUI.style.display = 'none';
            gameOverScreen.style.display = 'none';
            levelCompleteScreen.style.display = 'none';
            gameCompleteScreen.style.display = 'none';
            hideAllPopups();
            
            // Stop game if running
            gameRunning = false;
        }
        
        // Show level menu
        function showLevelMenu() {
            mainMenu.style.display = 'none';
            levelMenu.style.display = 'block';
            hideAllPopups();
            
            // Generate level buttons
            levelGrid.innerHTML = '';
            for (let i = 0; i < LEVELS.length; i++) {
                const levelBtn = document.createElement('button');
                levelBtn.className = 'level-btn';
                levelBtn.textContent = `${i + 1}`;
                levelBtn.title = LEVELS[i].name;
                
                // Mark completed levels
                if (completedLevels[i]) {
                    levelBtn.classList.add('completed');
                }
                
                // Lock levels that haven't been completed yet (except level 1)
                if (i > 0 && !completedLevels[i-1] && !completedLevels[i]) {
                    levelBtn.classList.add('locked');
                } else {
                    levelBtn.onclick = () => startLevel(i);
                }
                
                levelGrid.appendChild(levelBtn);
            }
        }
        
        // Show instructions popup
        function showInstructions() {
            instructionsPopup.style.display = 'block';
        }
        
        // Show credits popup
        function showCredits() {
            creditsPopup.style.display = 'block';
        }
        
        // Hide a specific popup
        function hidePopup(popupId) {
            document.getElementById(popupId).style.display = 'none';
        }
        
        // Hide all popups
        function hideAllPopups() {
            instructionsPopup.style.display = 'none';
            creditsPopup.style.display = 'none';
        }
        
        // Start a random level
        function startRandomLevel() {
            const availableLevels = [];
            for (let i = 0; i < LEVELS.length; i++) {
                if (i === 0 || completedLevels[i-1] || completedLevels[i]) {
                    availableLevels.push(i);
                }
            }
            
            if (availableLevels.length > 0) {
                const randomIndex = Math.floor(Math.random() * availableLevels.length);
                startLevel(availableLevels[randomIndex]);
            }
        }
        
        // Player class
        class Player {
            constructor(levelConfig) {
                this.width = 50;
                this.height = 40;
                this.x = canvas.width / 2;
                this.y = canvas.height - 100;
                this.speed = levelConfig.playerSpeed;
                this.color = '#00a8ff';
                this.bullets = [];
                this.missiles = [];
                this.bulletCooldown = 0;
                this.missileCooldown = 0;
                this.lives = 3;
                this.score = 0;
                this.missileCount = levelConfig.missileCount;
            }
            
            draw() {
                // Draw player ship
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y - this.height/2);
                ctx.lineTo(this.x - this.width/2, this.y + this.height/2);
                ctx.lineTo(this.x + this.width/2, this.y + this.height/2);
                ctx.closePath();
                ctx.fill();
                
                // Draw engine glow
                ctx.fillStyle = '#ffff00';
                ctx.beginPath();
                ctx.moveTo(this.x - 10, this.y + this.height/2);
                ctx.lineTo(this.x, this.y + this.height/2 + 15);
                ctx.lineTo(this.x + 10, this.y + this.height/2);
                ctx.closePath();
                ctx.fill();
            }
            
            move(keys) {
                if ((keys['ArrowLeft'] || keys['left']) && this.x - this.width/2 > 0) {
                    this.x -= this.speed;
                }
                if ((keys['ArrowRight'] || keys['right']) && this.x + this.width/2 < canvas.width) {
                    this.x += this.speed;
                }
                if ((keys['ArrowUp'] || keys['up']) && this.y - this.height/2 > 0) {
                    this.y -= this.speed;
                }
                if ((keys['ArrowDown'] || keys['down']) && this.y + this.height/2 < canvas.height) {
                    this.y += this.speed;
                }
            }
            
            shootBullet() {
                if (this.bulletCooldown === 0) {
                    this.bullets.push(new Bullet(this.x, this.y - this.height/2, -1, '#ffffff'));
                    this.bulletCooldown = 10;
                }
            }
            
            shootMissile() {
                if (this.missileCooldown === 0 && this.missiles.length < this.missileCount) {
                    this.missiles.push(new Missile(this.x, this.y - this.height/2));
                    this.missileCooldown = 30;
                    missilesElement.textContent = this.missileCount - this.missiles.length;
                }
            }
            
            updateCooldowns() {
                if (this.bulletCooldown > 0) {
                    this.bulletCooldown--;
                }
                if (this.missileCooldown > 0) {
                    this.missileCooldown--;
                }
            }
        }
        
        // Enemy class
        class Enemy {
            constructor(x, y, direction, levelConfig) {
                this.width = 40;
                this.height = 40;
                this.x = x;
                this.y = y;
                this.horizontalSpeed = Math.random() * levelConfig.enemySpeed + 1;
                this.verticalSpeed = 0.1;
                this.direction = direction;
                this.color = '#ff4d4d';
                this.health = levelConfig.enemyHealth;
                this.originalDirection = direction;
                this.bullets = [];
                this.shootCooldown = Math.floor(Math.random() * 100) + 50;
                this.shootFrequency = Math.floor(Math.random() * 100) + 100;
                this.levelConfig = levelConfig;
            }
            
            draw() {
                // Draw enemy fighter jet
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.moveTo(this.x, this.y + this.height/2);
                ctx.lineTo(this.x - this.width/2, this.y - this.height/2);
                ctx.lineTo(this.x + this.width/2, this.y - this.height/2);
                ctx.closePath();
                ctx.fill();
                
                // Draw enemy engine glow
                ctx.fillStyle = '#ff6666';
                ctx.beginPath();
                ctx.moveTo(this.x - 8, this.y + this.height/2);
                ctx.lineTo(this.x, this.y + this.height/2 + 12);
                ctx.lineTo(this.x + 8, this.y + this.height/2);
                ctx.closePath();
                ctx.fill();
                
                // Draw enemy cockpit
                ctx.fillStyle = '#ffff00';
                ctx.beginPath();
                ctx.arc(this.x, this.y, 6, 0, Math.PI * 2);
                ctx.fill();
                
                // Draw health bar for enemies with more than 1 health
                if (this.health > 1) {
                    const barWidth = 30;
                    const barHeight = 4;
                    const barX = this.x - barWidth/2;
                    const barY = this.y - this.height/2 - 10;
                    
                    // Background
                    ctx.fillStyle = '#333';
                    ctx.fillRect(barX, barY, barWidth, barHeight);
                    
                    // Health
                    ctx.fillStyle = this.health > 2 ? '#4dff4d' : '#ffff00';
                    const healthWidth = (this.health / this.levelConfig.enemyHealth) * barWidth;
                    ctx.fillRect(barX, barY, healthWidth, barHeight);
                }
            }
            
            move(otherEnemies) {
                // Store original position
                const originalX = this.x;
                const originalY = this.y;
                
                // Try to move horizontally
                this.x += this.horizontalSpeed * this.direction;
                
                // Change direction when hitting screen edges
                if (this.x - this.width/2 <= 0 || this.x + this.width/2 >= canvas.width) {
                    this.direction *= -1;
                    this.x = originalX;
                }
                
                // Check for collisions with other enemies
                let collisionDetected = false;
                for (const otherEnemy of otherEnemies) {
                    if (otherEnemy !== this && this.collidesWith(otherEnemy)) {
                        collisionDetected = true;
                        break;
                    }
                }
                
                // If collision detected, revert position and change direction
                if (collisionDetected) {
                    this.x = originalX;
                    this.direction *= -1;
                    
                    // Try moving in opposite direction
                    this.x += this.horizontalSpeed * this.direction;
                    
                    // Check again for collisions
                    collisionDetected = false;
                    for (const otherEnemy of otherEnemies) {
                        if (otherEnemy !== this && this.collidesWith(otherEnemy)) {
                            collisionDetected = true;
                            break;
                        }
                    }
                    
                    // If still colliding, don't move horizontally
                    if (collisionDetected) {
                        this.x = originalX;
                    }
                }
                
                // Very slow vertical descent
                this.y += this.verticalSpeed;
                
                // Update shooting cooldown
                if (this.shootCooldown > 0) {
                    this.shootCooldown--;
                }
            }
            
            shoot() {
                if (this.shootCooldown === 0) {
                    this.bullets.push(new Bullet(this.x, this.y + this.height/2, 1, '#ff6666', this.levelConfig.enemyBulletSpeed));
                    this.shootCooldown = this.shootFrequency;
                }
            }
            
            updateBullets() {
                for (let i = this.bullets.length - 1; i >= 0; i--) {
                    this.bullets[i].move();
                    if (this.bullets[i].isOffScreen()) {
                        this.bullets.splice(i, 1);
                    }
                }
            }
            
            drawBullets() {
                for (const bullet of this.bullets) {
                    bullet.draw();
                }
            }
            
            // Check if this enemy collides with another enemy
            collidesWith(otherEnemy) {
                const dx = this.x - otherEnemy.x;
                const dy = this.y - otherEnemy.y;
                const distance = Math.sqrt(dx * dx + dy * dy);
                const minDistance = (this.width + otherEnemy.width) / 2;
                return distance < minDistance;
            }
            
            isOffScreen() {
                return this.y > canvas.height + this.height;
            }
        }
        
        // Bullet class
        class Bullet {
            constructor(x, y, direction, color, speed = 7) {
                this.x = x;
                this.y = y;
                this.speed = speed;
                this.radius = 3;
                this.direction = direction;
                this.color = color;
            }
            
            draw() {
                ctx.fillStyle = this.color;
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
                ctx.fill();
            }
            
            move() {
                this.y += this.speed * this.direction;
            }
            
            isOffScreen() {
                if (this.direction === -1) {
                    return this.y < 0;
                } else {
                    return this.y > canvas.height;
                }
            }
        }
        
        // Missile class
        class Missile {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.speed = 6;
                this.width = 8;
                this.height = 20;
                this.target = null;
                this.angle = 0;
                this.color = '#ffff00';
                this.trail = [];
            }
            
            draw() {
                // Save current context
                ctx.save();
                
                // Move to missile position and rotate
                ctx.translate(this.x, this.y);
                ctx.rotate(this.angle);
                
                // Draw missile body
                ctx.fillStyle = this.color;
                ctx.fillRect(-this.width/2, -this.height/2, this.width, this.height);
                
                // Draw missile tip
                ctx.fillStyle = '#ff4d4d';
                ctx.beginPath();
                ctx.moveTo(0, -this.height/2 - 5);
                ctx.lineTo(-this.width/2, -this.height/2);
                ctx.lineTo(this.width/2, -this.height/2);
                ctx.closePath();
                ctx.fill();
                
                // Draw engine flame
                ctx.fillStyle = '#ff9900';
                ctx.beginPath();
                ctx.moveTo(-this.width/3, this.height/2);
                ctx.lineTo(0, this.height/2 + 10);
                ctx.lineTo(this.width/3, this.height/2);
                ctx.closePath();
                ctx.fill();
                
                // Restore context
                ctx.restore();
                
                // Draw trail
                for (let i = 0; i < this.trail.length; i++) {
                    const alpha = i / this.trail.length;
                    ctx.fillStyle = `rgba(255, 200, 0, ${alpha})`;
                    ctx.beginPath();
                    ctx.arc(this.trail[i].x, this.trail[i].y, 2, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            move(enemies) {
                // Add current position to trail
                this.trail.push({x: this.x, y: this.y});
                if (this.trail.length > 8) {
                    this.trail.shift();
                }
                
                // Find the closest enemy if no target
                if (this.target === null || this.target >= enemies.length || enemies[this.target].health <= 0) {
                    let closestDist = Infinity;
                    this.target = null;
                    for (let i = 0; i < enemies.length; i++) {
                        if (enemies[i].health > 0) {
                            const dx = this.x - enemies[i].x;
                            const dy = this.y - enemies[i].y;
                            const dist = Math.sqrt(dx * dx + dy * dy);
                            if (dist < closestDist) {
                                closestDist = dist;
                                this.target = i;
                            }
                        }
                    }
                    
                    if (this.target === null) {
                        // No target found, move upward
                        this.y -= this.speed;
                        this.angle = 0;
                        return;
                    }
                }
                
                // Move towards target
                const targetX = enemies[this.target].x;
                const targetY = enemies[this.target].y;
                
                // Calculate direction
                const dx = targetX - this.x;
                const dy = targetY - this.y;
                const dist = Math.max(Math.sqrt(dx * dx + dy * dy), 0.1);
                
                // Calculate angle for missile rotation
                this.angle = Math.atan2(dy, dx) + Math.PI/2;
                
                // Normalize and apply speed
                this.x += (dx / dist) * this.speed;
                this.y += (dy / dist) * this.speed;
            }
            
            isOffScreen() {
                return this.y < -this.height || this.y > canvas.height + this.height || 
                       this.x < -this.width || this.x > canvas.width + this.width;
            }
        }
        
        // Explosion class
        class Explosion {
            constructor(x, y) {
                this.x = x;
                this.y = y;
                this.radius = 5;
                this.maxRadius = 30;
                this.growthRate = 2;
                this.particles = [];
                
                // Create explosion particles
                for (let i = 0; i < 15; i++) {
                    this.particles.push({
                        x: this.x,
                        y: this.y,
                        speedX: (Math.random() - 0.5) * 8,
                        speedY: (Math.random() - 0.5) * 8,
                        radius: Math.random() * 3 + 1,
                        color: i % 2 === 0 ? '#ffff00' : '#ff4d4d'
                    });
                }
            }
            
            draw() {
                for (const particle of this.particles) {
                    ctx.fillStyle = particle.color;
                    ctx.beginPath();
                    ctx.arc(particle.x, particle.y, particle.radius, 0, Math.PI * 2);
                    ctx.fill();
                }
            }
            
            update() {
                for (const particle of this.particles) {
                    particle.x += particle.speedX;
                    particle.y += particle.speedY;
                    particle.radius *= 0.95;
                }
                
                return this.particles[0].radius < 0.5;
            }
        }
        
        // Initialize enemies based on current level
        function initializeEnemies() {
            enemies = [];
            const levelConfig = LEVELS[currentLevel];
            const enemyWidth = 40;
            const enemyHeight = 40;
            const padding = 60;
            
            // Calculate grid dimensions
            const cols = Math.min(6, Math.ceil(Math.sqrt(levelConfig.enemyCount)));
            const rows = Math.ceil(levelConfig.enemyCount / cols);
            const startY = 80;
            const startX = (canvas.width - (cols * (enemyWidth + padding))) / 2 + enemyWidth/2;
            
            let enemyIndex = 0;
            for (let row = 0; row < rows && enemyIndex < levelConfig.enemyCount; row++) {
                for (let col = 0; col < cols && enemyIndex < levelConfig.enemyCount; col++) {
                    const x = startX + col * (enemyWidth + padding);
                    const y = startY + row * (enemyHeight + padding);
                    const direction = (col % 2 === 0) ? 1 : -1;
                    
                    enemies.push(new Enemy(x, y, direction, levelConfig));
                    enemyIndex++;
                }
            }
        }
        
        // Start a new level
        function startLevel(level) {
            currentLevel = level;
            const levelConfig = LEVELS[currentLevel];
            
            player = new Player(levelConfig);
            explosions = [];
            gameOver = false;
            levelComplete = false;
            gameRunning = true;
            
            // Hide all screens and show game UI
            splashScreen.style.display = 'none';
            mainMenu.style.display = 'none';
            levelMenu.style.display = 'none';
            gameUI.style.display = 'block';
            gameOverScreen.style.display = 'none';
            levelCompleteScreen.style.display = 'none';
            gameCompleteScreen.style.display = 'none';
            hideAllPopups();
            
            // Update UI
            levelIndicator.textContent = `LEVEL ${currentLevel + 1}: ${levelConfig.name}`;
            scoreElement.textContent = player.score;
            livesElement.textContent = player.lives;
            missilesElement.textContent = player.missileCount;
            
            // Initialize enemies for this level
            initializeEnemies();
            enemiesElement.textContent = enemies.length;
        }
        
        // Key event listeners
        window.addEventListener('keydown', (e) => {
            keys[e.key] = true;
            
            if (e.key === ' ' && !gameOver && !levelComplete && player) {
                player.shootBullet();
            }
            if ((e.key === 'm' || e.key === 'M') && !gameOver && !levelComplete && player) {
                player.shootMissile();
            }
            if (e.key === 'Escape') {
                showMainMenu();
            }
        });
        
        window.addEventListener('keyup', (e) => {
            keys[e.key] = false;
        });
        
        // On-screen control event listeners
        function setupTouchControls() {
            // Direction controls
            dPadUp.addEventListener('touchstart', () => keys['up'] = true);
            dPadUp.addEventListener('touchend', () => keys['up'] = false);
            dPadDown.addEventListener('touchstart', () => keys['down'] = true);
            dPadDown.addEventListener('touchend', () => keys['down'] = false);
            dPadLeft.addEventListener('touchstart', () => keys['left'] = true);
            dPadLeft.addEventListener('touchend', () => keys['left'] = false);
            dPadRight.addEventListener('touchstart', () => keys['right'] = true);
            dPadRight.addEventListener('touchend', () => keys['right'] = false);
            
            // Action buttons
            shootBtn.addEventListener('touchstart', () => {
                if (!gameOver && !levelComplete && player) {
                    player.shootBullet();
                }
            });
            
            missileBtn.addEventListener('touchstart', () => {
                if (!gameOver && !levelComplete && player) {
                    player.shootMissile();
                }
            });
            
            // Mouse controls for testing on desktop
            dPadUp.addEventListener('mousedown', () => keys['up'] = true);
            dPadUp.addEventListener('mouseup', () => keys['up'] = false);
            dPadDown.addEventListener('mousedown', () => keys['down'] = true);
            dPadDown.addEventListener('mouseup', () => keys['down'] = false);
            dPadLeft.addEventListener('mousedown', () => keys['left'] = true);
            dPadLeft.addEventListener('mouseup', () => keys['left'] = false);
            dPadRight.addEventListener('mousedown', () => keys['right'] = true);
            dPadRight.addEventListener('mouseup', () => keys['right'] = false);
            
            shootBtn.addEventListener('mousedown', () => {
                if (!gameOver && !levelComplete && player) {
                    player.shootBullet();
                }
            });
            
            missileBtn.addEventListener('mousedown', () => {
                if (!gameOver && !levelComplete && player) {
                    player.shootMissile();
                }
            });
        }
        
        setupTouchControls();
        
        // Restart game function
        function restartGame() {
            startLevel(currentLevel);
        }
        
        // Next level function
        function nextLevel() {
            // Mark current level as completed
            completedLevels[currentLevel] = true;
            
            if (currentLevel < LEVELS.length - 1) {
                startLevel(currentLevel + 1);
            } else {
                // Game completed
                gameCompleteScreen.style.display = 'block';
                totalScoreElement.textContent = player.score;
                gameUI.style.display = 'none';
            }
        }
        
        // Game loop
        function gameLoop() {
            // Clear canvas with semi-transparent black for trail effect
            ctx.fillStyle = 'rgba(0, 0, 0, 0.1)';
            ctx.fillRect(0, 0, canvas.width, canvas.height);
            
            if (player && !gameOver && !levelComplete && gameRunning) {
                // Update player
                player.move(keys);
                player.updateCooldowns();
                
                // Update bullets
                for (let i = player.bullets.length - 1; i >= 0; i--) {
                    player.bullets[i].move();
                    if (player.bullets[i].isOffScreen()) {
                        player.bullets.splice(i, 1);
                    }
                }
                
                // Update missiles
                for (let i = player.missiles.length - 1; i >= 0; i--) {
                    player.missiles[i].move(enemies);
                    if (player.missiles[i].isOffScreen()) {
                        player.missiles.splice(i, 1);
                        missilesElement.textContent = player.missileCount - player.missiles.length;
                    }
                }
                
                // Update enemies and their bullets
                for (let i = enemies.length - 1; i >= 0; i--) {
                    enemies[i].move(enemies);
                    enemies[i].updateBullets();
                    
                    // Enemy shooting logic based on level configuration
                    if (Math.random() < LEVELS[currentLevel].enemyShootFrequency) {
                        enemies[i].shoot();
                    }
                    
                    if (enemies[i].isOffScreen()) {
                        enemies.splice(i, 1);
                    }
                }
                
                // Check player bullet collisions with enemies
                for (let i = player.bullets.length - 1; i >= 0; i--) {
                    for (let j = enemies.length - 1; j >= 0; j--) {
                        const bullet = player.bullets[i];
                        const enemy = enemies[j];
                        
                        if (Math.abs(bullet.x - enemy.x) < enemy.width/2 && 
                            Math.abs(bullet.y - enemy.y) < enemy.height/2) {
                            player.bullets.splice(i, 1);
                            enemy.health -= 1;
                            if (enemy.health <= 0) {
                                explosions.push(new Explosion(enemy.x, enemy.y));
                                enemies.splice(j, 1);
                                player.score += 10 * (currentLevel + 1);
                                scoreElement.textContent = player.score;
                            }
                            break;
                        }
                    }
                }
                
                // Check missile collisions
                for (let i = player.missiles.length - 1; i >= 0; i--) {
                    for (let j = enemies.length - 1; j >= 0; j--) {
                        const missile = player.missiles[i];
                        const enemy = enemies[j];
                        
                        if (Math.abs(missile.x - enemy.x) < enemy.width/2 && 
                            Math.abs(missile.y - enemy.y) < enemy.height/2) {
                            player.missiles.splice(i, 1);
                            explosions.push(new Explosion(enemy.x, enemy.y));
                            enemies.splice(j, 1);
                            player.score += 20 * (currentLevel + 1);
                            scoreElement.textContent = player.score;
                            missilesElement.textContent = player.missileCount - player.missiles.length;
                            break;
                        }
                    }
                }
                
                // Check enemy bullet collisions with player
                for (const enemy of enemies) {
                    for (let i = enemy.bullets.length - 1; i >= 0; i--) {
                        const bullet = enemy.bullets[i];
                        
                        if (Math.abs(bullet.x - player.x) < player.width/2 && 
                            Math.abs(bullet.y - player.y) < player.height/2) {
                            enemy.bullets.splice(i, 1);
                            player.lives -= 1;
                            livesElement.textContent = player.lives;
                            explosions.push(new Explosion(player.x, player.y));
                            
                            if (player.lives <= 0) {
                                gameOver = true;
                                finalScoreElement.textContent = player.score;
                                finalLevelElement.textContent = currentLevel + 1;
                                gameOverScreen.style.display = 'block';
                                gameUI.style.display = 'none';
                            }
                            break;
                        }
                    }
                }
                
                // Check enemy collisions with player
                for (let i = enemies.length - 1; i >= 0; i--) {
                    const enemy = enemies[i];
                    if (Math.abs(player.x - enemy.x) < (player.width/2 + enemy.width/2) && 
                        Math.abs(player.y - enemy.y) < (player.height/2 + enemy.height/2)) {
                        explosions.push(new Explosion(enemy.x, enemy.y));
                        enemies.splice(i, 1);
                        player.lives -= 1;
                        livesElement.textContent = player.lives;
                        
                        if (player.lives <= 0) {
                            gameOver = true;
                            finalScoreElement.textContent = player.score;
                            finalLevelElement.textContent = currentLevel + 1;
                            gameOverScreen.style.display = 'block';
                            gameUI.style.display = 'none';
                        }
                    }
                }
                
                // Check if level is complete
                if (enemies.length === 0) {
                    levelComplete = true;
                    completeScoreElement.textContent = player.score;
                    
                    if (currentLevel < LEVELS.length - 1) {
                        nextLevelNumberElement.textContent = currentLevel + 2;
                        levelCompleteScreen.style.display = 'block';
                    } else {
                        // Game completed
                        gameCompleteScreen.style.display = 'block';
                        totalScoreElement.textContent = player.score;
                    }
                    
                    gameUI.style.display = 'none';
                }
                
                // Update UI
                enemiesElement.textContent = enemies.length;
            }
            
            // Update explosions
            for (let i = explosions.length - 1; i >= 0; i--) {
                if (explosions[i].update()) {
                    explosions.splice(i, 1);
                }
            }
            
            // Draw everything
            if (player && gameRunning) {
                player.draw();
                
                for (const bullet of player.bullets) {
                    bullet.draw();
                }
                
                for (const missile of player.missiles) {
                    missile.draw();
                }
            }
            
            for (const enemy of enemies) {
                enemy.draw();
                enemy.drawBullets();
            }
            
            for (const explosion of explosions) {
                explosion.draw();
            }
            
            // Continue game loop
            requestAnimationFrame(gameLoop);
        }
        
        // Initialize the game
        createSpaceBackground();
        simulateLoading();
        gameLoop();
    </script>
</body>
</html>
